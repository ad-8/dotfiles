set $mod Mod4
set $alt Mod1

set $left h
set $down j
set $up k
set $right l

set $term alacritty

set $menu wmenu-run
set $menu2 i3-dmenu-desktop --dmenu='dmenu -i -fn "HackNerdFont 12" -nb "#3b4252" -nf "#d8dee9" -sb "#d08770" -sf "#000000"'

# Nord Polar Night
set $polar1 #2e3440
set $polar2 #3b4252
set $polar3 #434c5e
set $polar4 #4c566a

# Nord Snow Storm
set $snow1 #d8dee9
set $snow2 #e5e9f0
set $snow3 #eceff4

# Nord Frost
set $frost1 #8fbcbb
set $frost2 #88c0d0
set $frost3 #81a1c1
set $frost4 #5e81ac

# Nord Aurora
set $red    #bf616a
set $orange #d08770
set $yellow #ebcb8b
set $green  #a3be8c
set $lila   #b48ead

set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"

workspace_layout default

exec --no-startup-id waybar
exec --no-startup-id blueman-applet
exec --no-startup-id dunst
exec --no-startup-id firefox
#exec --no-startup-id megasync
exec --no-startup-id nm-applet
exec --no-startup-id firewall-applet
exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec --no-startup-id "~/scripts/bb/licht.clj hi"

font pango:HackNerdFont 9.0

# class                 border  backgr. text    indicator child_border
client.focused          $frost4 $frost4 $snow2  $frost4   $frost4
client.focused_inactive #333333 #5f676a #ffffff #484e50   #5f676a
client.unfocused        #333333 #222222 #888888 #292d2e   #222222
client.urgent           #2f343a #900000 #ffffff #900000   #900000
client.placeholder      #000000 #0c0c0c #ffffff #000000   #0c0c0c

client.background       #ffffff


# default colors for reference
# ----------------------------

# # class                 border  backgr. text    indicator child_border
# client.focused          #4c7899 #285577 #ffffff #2e9ef4   #285577
# client.focused_inactive #333333 #5f676a #ffffff #484e50   #5f676a
# client.unfocused        #333333 #222222 #888888 #292d2e   #222222
# client.urgent           #2f343a #900000 #ffffff #900000   #900000
# client.placeholder      #000000 #0c0c0c #ffffff #000000   #0c0c0c
#
# client.background       #ffffff

# hide title bar for all windows
for_window [class="^.*"] border pixel 3

mouse_warping container

for_window [class="Xfce4-notifyd"] border pixel 0
for_window [class="io.github.celluloid_player.Celluloid"] border pixel 0
#for_window [class="Xfce4-appfinder"] border pixel 0
#for_window [class="Blueman-manager"] border pixel 0

for_window [app_id="xfce4-appfinder"] floating enable
#for_window [app_id="xfce4-appfinder"] border pixel 5
for_window [app_id="xfce4-appfinder"] resize set 800 600
for_window [app_id="xfce4-appfinder"] move position center

for_window [app_id="xfce4-about"] floating enable
for_window [app_id="xfce4-about"] resize set 800 600
for_window [app_id="xfce4-about"] move position center

for_window [app_id="blueman-manager"] floating enable
for_window [app_id="blueman-manager"] resize set 640 480
for_window [app_id="blueman-manager"] move position center

for_window [app_id="Alacritty" title="bluetui"] floating enable, resize set 1024 768, move position center

for_window [title="About Mozilla Firefox"] floating enable

for_window [app_id="org.pulseaudio.pavucontrol"] floating enable
for_window [app_id="org.pulseaudio.pavucontrol"] resize set 800 600
for_window [app_id="org.pulseaudio.pavucontrol"] move position center

for_window [app_id="wdisplays"] floating enable
for_window [app_id="wdisplays"] resize set 1024 768
for_window [app_id="wdisplays"] move position center

for_window [title="^About This System"] floating enable, move position center

for_window [app_id="qalculate-gtk"] floating enable, move position center

assign [app_id="firefox"] $ws2
assign [app_id="qbittorrent"] $ws7
assign [app_id="brave-browser"] $ws8
assign [app_id="org.strawberrymusicplayer.strawberry"] $ws8

assign [title="ax-emacs-emms"] $ws8
assign [class="Brave-browser"] $ws8
assign [app_id="KeePassXC"] $ws9
assign [class="KeePassXC"] $ws9
assign [app_id="protonvpn-app"] $ws9
assign [app_id="org.gnome.SystemMonitor"] $ws9

output * bg /home/ax/sync/wallpapers/default.jpg fill

output DP-1 position 0 0 resolution 3840x2160 scale 1.75
output HDMI-A-1 position 2560,360 resolution 1920x1080


workspace 1 output DP-1
workspace 2 output DP-1
workspace 3 output DP-1
workspace 4 output DP-1
workspace 5 output DP-1
workspace 7 output HDMI-A-1
workspace 8 output HDMI-A-1
workspace 9 output HDMI-A-1

exec swayidle -w \
         timeout 3600 'swaylock -f -c 000000 -F' \
         timeout 3700 'swaymsg "output * power off"' resume 'swaymsg "output * power on"' \
         before-sleep 'swaylock -f -c 000000 -F'

input type:keyboard {
    xkb_layout "de"
    xkb_numlock enabled
}

set $cursor_theme 'Numix-Cursor'
set $cursor_size 26
seat * xcursor_theme $cursor_theme $cursor_size
#seat seat0 xcursor_theme my_cursor_theme my_cursor_size

# Start a terminal
bindsym $mod+Return exec $term
bindsym $mod+Shift+Return exec ghostty

# Kill focused window
bindsym $mod+q kill
bindsym $mod+Shift+q kill

# Start your launcher
bindsym $mod+p exec $menu
bindsym $mod+Shift+p exec $menu2

# Drag floating windows by holding down $mod and left mouse button.
# Resize them with right mouse button + $mod.
# Despite the name, also works for non-floating windows.
# Change normal to inverse to use left mouse button for resizing and right
# mouse button for dragging.
floating_modifier $mod normal

# Reload the configuration file
bindsym $mod+Shift+r reload

# Exit sway (logs you out of your Wayland session)
bindsym $mod+Shift+e exec swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -B 'Yes, exit sway' 'swaymsg exit'

# Move your focus around
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right
# Or use $mod+[up|down|left|right]
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Move the focused window with the same, but add Shift
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right
# Ditto, with arrow keys
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
# Move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9

# You can "split" the current object of your focus with
# $mod+b or $mod+v, for horizontal and vertical splits
# respectively.
bindsym $mod+z splith
bindsym $mod+v splitv

# Switch the current container between different layout styles
bindsym $mod+s layout stacking
bindsym $mod+t layout tabbed
bindsym $mod+e layout toggle split

# Make the current focus fullscreen
bindsym $mod+f fullscreen

# Toggle the current focus between tiling and floating mode
bindsym $mod+Shift+space floating toggle

# Swap focus between the tiling area and the floating area
bindsym $mod+space focus mode_toggle

# Move focus to the parent container
bindsym $mod+Mod1+p focus parent

# Sway has a "scratchpad", which is a bag of holding for windows.
# You can send windows there and get them back later.

# Move the currently focused window to the scratchpad
bindsym $mod+Shift+minus move scratchpad

# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, this command cycles through them.
bindsym $mod+minus scratchpad show

# the main scratchpad like on dwm; so i don't have to manually move it first and then cycle through the stack if multiple pads
for_window [title="dwm-scratchpad"] floating enable, move to scratchpad
exec_always alacritty --title "dwm-scratchpad"
# Show only that specific scratchpad terminal
bindsym $mod+d [title="dwm-scratchpad"] scratchpad show, resize set 1024 768, move position center

# the main scratchpad like on dwm; so i don't have to manually move it first and then cycle through the stack if multiple pads
for_window [title="ax-org-capture"] floating enable, move to scratchpad
exec_always alacritty --title "ax-org-capture" --command emacs --no-window-system
# Show only that specific scratchpad terminal
bindsym $mod+u [title="ax-org-capture"] scratchpad show, resize set 1024 768, move position center

for_window [title="htop-scratchpad"] floating enable, move to scratchpad
exec alacritty --title "htop-scratchpad" -e htop
bindsym $mod+F12 [title="htop-scratchpad"] scratchpad show, resize set 1024 768, move position top-left

# Move Emacs with title "emacs-scratchpad" to scratchpad automatically
for_window [title="emacs-scratchpad-todo"] floating enable, move to scratchpad
# Launch Emacs with the special title
#exec_always emacs --title "emacs-scratchpad-todo" --file ~/sync/TODO.org
#exec_always emacsclient -c -F '((title . "emacs-scratchpad-todo"))'

bindsym $mod+F8 [title="emacs-scratchpad-todo"] scratchpad show, resize set 1000 800, move position center

# title for other emacs scratchpads should *not* start with emacs-scratchpad like above,
# else windows will end up kind of like stacked
for_window [title="scratchmacs"] floating enable, move to scratchpad
#exec_always emacs --title "scratchmacs"
bindsym $mod+i [title="scratchmacs"] scratchpad show, resize set 1000 800, move position center
bindsym $mod+F9 [title="scratchmacs"] scratchpad show, resize set 1000 800, move position center

bindsym $mod+Shift+o exec rofi -show drun
bindsym $mod+Shift+f exec rofi -show recursivebrowser
bindsym $mod+w exec rofi -show window

bindsym $mod+$alt+l exec swaylock --color 000000 --show-failed-attempts

bindsym $mod+b exec ~/scripts/waybar.clj toggle
bindsym $mod+shift+b exec ~/scripts/waybar.clj toggle-min

bindsym $mod+$alt+h exec dunstctl history-pop
bindsym $mod+$alt+k exec dunstctl close-all
bindsym $mod+$alt+w exec ~/scripts/bb/weather.clj dunst

# todo mod shift m for specialiezd bookmark stuff, maybe special mode?
bindsym $mod+m exec bb ~/x/ax_bookmarks.clj 
bindsym $mod+shift+s exec bb ~/scripts/bb/search.clj --select-provider

mode "resize" {
    # left will shrink the containers width
    # right will grow the containers width
    # up will shrink the containers height
    # down will grow the containers height
    bindsym $left resize shrink width 50px
    bindsym $down resize grow height 50px
    bindsym $up resize shrink height 50px
    bindsym $right resize grow width 50px

    # Ditto, with arrow keys
    bindsym Left resize shrink width 10px
    bindsym Down resize grow height 10px
    bindsym Up resize shrink height 10px
    bindsym Right resize grow width 10px

    # Return to default mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

# Pulse Audio controls
#bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume 0 +5%
#bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume 0 -5%
#bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute 0 toggle

# Media player controls
#bindsym XF86AudioPlay exec playerctl play-pause
#bindsym XF86AudioPause exec playerctl pause
#bindsym XF86AudioNext exec playerctl next
#bindsym XF86AudioPrev exec playerctl previous

# sxhkd VOLUME keybindings
# TODO not sure why sway on nixos doesn't see ~/.cargo/bin in $PATH
bindsym XF86AudioRaiseVolume exec ~/scripts/wayland.clj volume-up
bindsym XF86AudioLowerVolume exec ~/scripts/wayland.clj volume-down
bindsym XF86AudioMute exec ~/scripts/wayland.clj volume-mute
bindsym XF86AudioPlay exec ~/scripts/bb/play_pause.clj

bindsym $mod+$alt+up exec ~/scripts/wayland.clj volume-up
bindsym $mod+$alt+down exec ~/scripts/wayland.clj volume-down
bindsym $mod+$alt+left exec ~/scripts/wayland.clj volume-mute
bindsym $mod+$alt+right exec ~/scripts/bb/play_pause.clj
bindsym $mod+$alt+space exec ~/scripts/bb/play_pause.clj

bindsym XF86MonBrightnessUp exec ~/scripts/brightness screen inc
bindsym XF86MonBrightnessDown exec ~/scripts/brightness screen dec
bindsym XF86KbdBrightnessUp exec ~/scripts/brightness keyboard inc
bindsym XF86KbdBrightnessDown exec ~/scripts/brightness keyboard dec

workspace_auto_back_and_forth yes

bindsym $mod+Tab workspace back_and_forth
# bindsym $mod+Shift+b move container to workspace back_and_forth

bindsym $mod+shift+period move window to output left
bindsym $mod+shift+comma move workspace to output left
bindsym $mod+period focus output left
#bindsym $mod+Shift+Tab focus output prev

set $mode_space SPC: [a]ll-search [c]hange-settings [e]moji [g]search [r]un-script
set $mode_settings CHANGE SETTINGS: [b]luetooth [l]icht [s]creen-config rand-[w]allpaper
bindsym Mod1+space mode "$mode_space"

mode "$mode_space" {
    bindsym a exec "~/scripts/bb/search.clj --select-provider"; mode "default"
    bindsym e exec "~/scripts/dmenuunicode"; mode "default"
    bindsym g exec "~/scripts/bb/search.clj"; mode "default"
    bindsym r exec "~/scripts/bb/run_script.clj"; mode "default"

    bindsym c mode "$mode_settings"

    bindsym Escape mode "default"
}

mode "$mode_settings" {
    bindsym b exec blueman-manager; mode "default"
    bindsym l exec "~/scripts/bb/licht.clj"; mode "default"
    bindsym s exec screen_config; mode "default"
    bindsym w exec "$HOME/scripts/bb/set_random_wallpaper.clj"; mode "default"

    bindsym Escape mode "default"
}

set $mode_launcher Open:\n\n[a]i [b]luetooth [c]alc [e]macsclient [E]macs [f]ile-manager\n\n[k]eepass [m]usic-player [p]avucontrol\n\n[q]bittorrent [s]creenshot bra[v]e [w]ebapp firefo[x]
# set $mode_launcher Open: a b c e E f k m p q s v w x

set $mode_screenshot Screenshot: [a]ll outputs [s]elect region [w]indow

bindsym $mod+o exec notify-send -t 30000 -u low -i keyboard "$mode_launcher"; mode "$mode_launcher"

mode "$mode_launcher" {
    bindsym a exec chromium --app="https://kagi.com/assistant"; mode "default"; exec dunstctl close
    bindsym b exec alacritty --title bluetui --command bluetui; mode "default"; exec dunstctl close
    bindsym c exec qalculate-gtk; mode "default"; exec dunstctl close
    bindsym e exec emacsclient --create-frame --alternate-editor="vim"; mode "default"; exec dunstctl close
    bindsym shift+e exec emacs; mode "default"; exec dunstctl close
    bindsym f exec thunar; mode "default"; exec dunstctl close
    bindsym k exec keepassxc; mode "default"; exec dunstctl close
    bindsym m exec emacs --name ax-emacs-emms --eval '(ax/open-emms-layout)'; mode "default"; exec dunstctl close
    bindsym p exec pavucontrol; mode "default"; exec dunstctl close
    bindsym q exec qbittorrent; mode "default"; exec dunstctl close
    bindsym s exec dunstctl close; mode "$mode_screenshot";
    bindsym v exec $HOME/scripts/brave.sh; mode "default"; exec dunstctl close
    bindsym w mode webapp;
    bindsym x exec firefox; mode "default"; exec dunstctl close

    bindsym Escape mode "default"; exec dunstctl close
    bindsym Return mode "default"; exec dunstctl close
}


mode "$mode_screenshot" {
    # mode default first, because swappy (the screenshot gui) might be open for a while,
    # and we don't want to be stuck in a non-default meanwhile
    # TODO until we get rid of the dunst notifs, we need to sleep here, else the notif is in the screenshot
    bindsym a mode default; exec sleep 1; exec grim - | swappy -f -;
    bindsym s mode default; exec grim -g "$(slurp)" - | swappy -f -;
    bindsym w mode default; exec sleep 1; exec swaymsg -t get_tree | jq -r '.. | select(.focused?) | .rect | "\(.x),\(.y) \(.width)x\(.height)"' | grim -g - - | swappy -f -;
    
    bindsym Escape mode "default"; exec dunstctl close
    bindsym Return mode "default"; exec dunstctl close
}

mode "webapp" {
    bindsym a exec chromium --app="https://kagi.com/assistant"; mode "default"; exec dunstctl close
    bindsym c exec chromium --app="https://calendar.proton.me"; mode "default"; exec dunstctl close
    bindsym m exec chromium --app="https://mail.proton.me"; mode "default"; exec dunstctl close
    bindsym p exec chromium --app="https://search.nixos.org/packages"; mode "default"; exec dunstctl close
 
    bindsym Escape mode "default"; exec dunstctl close
    bindsym Return mode "default"; exec dunstctl close
}

set $my-inner 10
gaps inner $my-inner

# workspace $ws1 gaps horizontal 100
# workspace $ws1 gaps vertical   25
# workspace $ws1 gaps inner 10

#workspace $ws2 gaps horizontal 250
#workspace $ws2 gaps vertical   10

#workspace $ws3 gaps inner 25
#workspace $ws3 gaps horizontal 25
#workspace $ws3 gaps vertical   25

set $mode_gaps Gaps: (o)uter, (i)nner, (h)orizontal, (v)ertical, (t)op, (r)ight, (b)ottom, (l)eft
set $mode_gaps_outer Outer Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_inner Inner Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_horiz Horizontal Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_verti Vertical Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_top Top Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_right Right Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_bottom Bottom Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_left Left Gaps: +|-|0 (local), Shift + +|-|0 (global)
bindsym $mod+Shift+g mode "$mode_gaps"

mode "$mode_gaps" {
        bindsym o      mode "$mode_gaps_outer"
        bindsym i      mode "$mode_gaps_inner"
        bindsym h      mode "$mode_gaps_horiz"
        bindsym v      mode "$mode_gaps_verti"
        bindsym t      mode "$mode_gaps_top"
        bindsym r      mode "$mode_gaps_right"
        bindsym b      mode "$mode_gaps_bottom"
        bindsym l      mode "$mode_gaps_left"
        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}

mode "$mode_gaps_outer" {
        bindsym plus  gaps outer current plus 5
        bindsym minus gaps outer current minus 5
        bindsym 0     gaps outer current set 0

        bindsym Shift+plus  gaps outer all plus 5
        bindsym Shift+minus gaps outer all minus 5
        bindsym Shift+0     gaps outer all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}
mode "$mode_gaps_inner" {
        bindsym plus  gaps inner current plus 5
        bindsym minus gaps inner current minus 5
        bindsym 0     gaps inner current set 0

        bindsym Shift+plus  gaps inner all plus 5
        bindsym Shift+minus gaps inner all minus 5
        bindsym Shift+0     gaps inner all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}
mode "$mode_gaps_horiz" {
        bindsym plus  gaps horizontal current plus 5
        bindsym minus gaps horizontal current minus 5
        bindsym 0     gaps horizontal current set 0

        bindsym Shift+plus  gaps horizontal all plus 5
        bindsym Shift+minus gaps horizontal all minus 5
        bindsym Shift+0     gaps horizontal all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}
mode "$mode_gaps_verti" {
        bindsym plus  gaps vertical current plus 5
        bindsym minus gaps vertical current minus 5
        bindsym 0     gaps vertical current set 0

        bindsym Shift+plus  gaps vertical all plus 5
        bindsym Shift+minus gaps vertical all minus 5
        bindsym Shift+0     gaps vertical all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}
mode "$mode_gaps_top" {
        bindsym plus  gaps top current plus 5
        bindsym minus gaps top current minus 5
        bindsym 0     gaps top current set 0

        bindsym Shift+plus  gaps top all plus 5
        bindsym Shift+minus gaps top all minus 5
        bindsym Shift+0     gaps top all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}
mode "$mode_gaps_right" {
        bindsym plus  gaps right current plus 5
        bindsym minus gaps right current minus 5
        bindsym 0     gaps right current set 0

        bindsym Shift+plus  gaps right all plus 5
        bindsym Shift+minus gaps right all minus 5
        bindsym Shift+0     gaps right all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}
mode "$mode_gaps_bottom" {
        bindsym plus  gaps bottom current plus 5
        bindsym minus gaps bottom current minus 5
        bindsym 0     gaps bottom current set 0

        bindsym Shift+plus  gaps bottom all plus 5
        bindsym Shift+minus gaps bottom all minus 5
        bindsym Shift+0     gaps bottom all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}
mode "$mode_gaps_left" {
        bindsym plus  gaps left current plus 5
        bindsym minus gaps left current minus 5
        bindsym 0     gaps left current set 0

        bindsym Shift+plus  gaps left all plus 5
        bindsym Shift+minus gaps left all minus 5
        bindsym Shift+0     gaps left all set 0

        bindsym Return mode "$mode_gaps"
        bindsym Escape mode "default"
}

include /etc/sway/config.d/*
